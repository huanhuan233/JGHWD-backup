def build_prompt(article_title: str, section_title: str, kb_text: str = "", hw_text: str = "", prev_content: str = "") -> str:
    """
    构造用于大模型生成结构化段落的提示词 prompt，强化 Markdown 格式严谨性。
    """
    return (
        "你正在协助撰写一篇项目申报或结构化技术文档，请你扮演一位有经验的写作专家，需同时保证内容质量和格式严谨性。\n\n"
        f"【整篇文章标题】：{article_title}\n"
        f"【当前小节标题】：{section_title}\n"
        f"【相关知识内容】：\n{kb_text if kb_text.strip() else '无可用知识，请结合常识认真撰写'}\n\n"
        +(f"【上一小节内容】：{prev_content}\n\n" if prev_content else "")
        + (f"行文风格按照：\n\n{hw_text}\n\n" if hw_text else "")
        + "请根据当前小节标题并联系上一节内容和相关知识内容撰写结构化段落，需同时满足以下要求：\n"
        # 内容要求（保留核心，调整表述顺序）
        "- 围绕小节标题展开，紧密结合文章主题，避免脱离核心的无关内容；\n"
        + (f"无需返回上一小节的内容只是要求联系上下文继续书写写下面小节内容\n\n" if prev_content else "")
        +"- 不局限于术语解释或百科式内容，需体现分析性和逻辑性；\n"
        "- 内容不少于150字，用词准确、语句通顺，无语法错误；\n"
        "- 若知识不足，可基于常识合理发挥，但严禁跑题。\n"
        # 新增：明确且严谨的 Markdown 格式要求
        +"- 必须返回严格的 Markdown 格式，具体规则如下：\n"
        "  1. 段落：直接使用自然段落，无需额外符号；\n"
        "  2. 分级标题：若需拆分小节，使用 `##`（二级标题）、`###`（三级标题），标题后需加空格再写内容，且**标题文本必须完全保留【当前小节标题】中的原始内容（包括序号、括号等符号）**（例：若当前小节标题为“XXXX”，则一级标题需写为 `# XXXX`）；\n"  # 核心修改点
        "  3. 列表：如需分点，统一使用 `- `（短横线+空格）作为无序列表符号，或 `1. ` 作为有序列表符号，符号后必须加空格；\n"
        "  4. 表格：若需展示数据，必须严格遵循以下语法：\n"
        "     - 表格前后要有空行；\n"
        "     - 表头行：用 `|` 分隔列名，例：`| 技术挑战 | 解决方案 | 预期效果 |`\n"
        "     - 分隔线行：表头下方必须紧跟分隔线，格式为 `| --- | --- | --- |`（列数与表头完全一致，`---` 数量不限制，但必须有 `-`）\n"
        "     - 内容行：每行内容用 `|` 分隔，且列数与表头、分隔线完全匹配，不允许空行或列数不对应；\n"
        "     - 禁止：表格前后不允许添加多余符号（如空格、换行外的特殊字符），确保表格整体连续且无中断；\n"
        "     - 表格结尾以 `|` 结束，即最后一行的末尾也需要加上 `|` 符号；\n"
        "  5. 强调：关键内容可用 `** 加粗 **` 或 `* 斜体 *`，但避免过度使用；\n"
        "  6. 禁止：不允许使用Markdown不支持的格式（如自定义颜色、字体），不允许混用格式符号（如列表同时用 `-` 和 `*`）。\n"
        "  7. 开头不允许返回‘```markdown’"
    )